<!DOCTYPE html>
<html>
<head>
    <title>Test Audio Enable</title>
</head>
<body>
    <h1>Test Audio Enable Button</h1>
    <button onclick="testAudioEnable()">ğŸ”Š Enable Audio</button>
    <button onclick="testSpeech()">ğŸš¨ Test Speech</button>
    <div id="status"></div>

    <script>
        let audioEnabled = false;

        async function testAudioEnable() {
            const status = document.getElementById('status');
            status.innerHTML = 'ğŸ”Š Enabling audio...';
            
            try {
                // Create and play a minimal silent audio to unlock autoplay
                const silentAudio = new Audio();
                silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAAAQESsAEBErAAAAAAAAgAQAGRhdGEEAAAAAAA=';
                silentAudio.volume = 0.01;
                silentAudio.muted = true;
                
                await silentAudio.play();
                audioEnabled = true;
                status.innerHTML = 'âœ… Audio enabled successfully!';
                console.log('âœ… Audio enabled successfully');
                
            } catch (error) {
                console.warn('âš ï¸ Could not enable audio:', error);
                status.innerHTML = `âŒ Audio enable failed: ${error.message}`;
            }
        }

        async function testSpeech() {
            const status = document.getElementById('status');
            
            if (!audioEnabled) {
                status.innerHTML = 'âŒ Audio not enabled - click Enable Audio first';
                return;
            }
            
            status.innerHTML = 'ğŸ”Š Testing speech...';
            
            try {
                // Test the backend speech endpoint
                const response = await fetch('http://127.0.0.1:8000/speech/alert', {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        attack_type: 'DDoS',
                        source_ip: '192.168.1.100',
                        confidence: 0.95
                    })
                });

                if (!response.ok) {
                    throw new Error(`Speech API error: ${response.status}`);
                }

                const audioBuffer = await response.arrayBuffer();
                console.log('âœ… Got audio buffer:', audioBuffer.byteLength, 'bytes');

                const audioBlob = new Blob([audioBuffer], { type: 'audio/mpeg' });
                const audioUrl = URL.createObjectURL(audioBlob);

                const audio = new Audio(audioUrl);
                audio.volume = 0.8;

                await audio.play();
                console.log('âœ… Audio playing!');
                status.innerHTML = 'âœ… Speech playing!';

                audio.addEventListener('ended', () => {
                    URL.revokeObjectURL(audioUrl);
                    console.log('ğŸ”Š Audio finished');
                    status.innerHTML = 'ğŸ”Š Speech completed!';
                });

            } catch (error) {
                console.error('âŒ Speech test failed:', error);
                status.innerHTML = `âŒ Speech failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>